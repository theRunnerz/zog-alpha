<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PINKERTAPE SENTINEL | WAR ROOM</title>
    <style>
        :root {
            --neon-green: #0f0;
            --neon-red: #f00;
            --bg-color: #050a05;
            --panel-bg: #0a110a;
            --border-color: #1a331a;
        }
        body {
            background-color: var(--bg-color);
            color: var(--neon-green);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            height: 100vh;
            overflow: hidden;
        }

        /* --- LAYOUT --- */
        .main-feed { grid-column: 1; display: flex; flex-direction: column; gap: 20px; }
        .sidebar { grid-column: 2; display: flex; flex-direction: column; gap: 20px; }
        
        .panel {
            border: 1px solid var(--border-color);
            background: var(--panel-bg);
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.1);
            position: relative;
        }
        
        h2 {
            margin-top: 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            font-size: 1.2rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* --- TERMINAL FEED --- */
        #log-feed {
            height: 300px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        .log-entry { margin-bottom: 5px; }
        .timestamp { color: #555; margin-right: 10px; }
        .alert { color: var(--neon-red); font-weight: bold; }
        .info { color: #0ff; }

        /* --- BANKING UI (NEW PHASE 4) --- */
        .bank-input {
            width: 100%;
            background: #000;
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            padding: 10px;
            margin-bottom: 10px;
            font-family: inherit;
            box-sizing: border-box; /* Fixes padding width issue */
        }
        .bank-btn {
            width: 100%;
            background: var(--neon-green);
            color: #000;
            border: none;
            padding: 15px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s;
        }
        .bank-btn:hover {
            background: #fff;
            box-shadow: 0 0 15px var(--neon-green);
        }
        .status-light {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #333;
            margin-right: 10px;
        }
        .status-light.active { background: var(--neon-green); box-shadow: 0 0 5px var(--neon-green); }

        /* --- ALERTS --- */
        .market-card {
            border-left: 3px solid var(--neon-green);
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(0, 255, 0, 0.05);
        }

    </style>
</head>
<body>

    <!-- LEFT COLUMN: INTELLIGENCE -->
    <div class="main-feed">
        <div class="panel">
            <h2>üì° LIVE INTERCEPT LOG</h2>
            <div id="log-feed">
                <div class="log-entry"><span class="timestamp">INITIALIZING...</span> SYSTEM ONLINE</div>
                <div class="log-entry"><span class="timestamp">SCANNING...</span> CONNECTED TO TRONGRID (SHASTA)</div>
                <div class="log-entry"><span class="timestamp">WAITING...</span> LISTENING FOR WHALES</div>
            </div>
        </div>

        <div class="panel" style="flex-grow: 1;">
            <h2>‚ö° ACTIVE MARKETS</h2>
            <div id="market-container">
                <!-- Markets appear here dynamically -->
                <div class="market-card">
                    <h3>MARKET #001: WAITING FOR SIGNAL...</h3>
                    <p>Status: SCANNING MEMPOOL</p>
                </div>
            </div>
        </div>
    </div>

    <!-- RIGHT COLUMN: CONTROLS & BANK -->
    <div class="sidebar">
        
        <!-- PHASE 4: SOCIAL BANKING INTERFACE -->
        <div class="panel">
            <h2>üè¶ OPERATOR UPLINK</h2>
            <div style="margin-bottom: 15px; display: flex; align-items: center;">
                <span id="wallet-status" class="status-light"></span>
                <span id="wallet-address">Wallet: DISCONNECTED</span>
            </div>

            <label>SOCIAL HANDLE</label>
            <input type="text" id="twitter-handle" class="bank-input" placeholder="@SunGenX_Fan">

            <label>DEPOSIT AMOUNT (TRX)</label>
            <input type="number" id="deposit-amount" class="bank-input" placeholder="100">

            <button onclick="depositFunds()" class="bank-btn">AUTHORIZE DEPOSIT</button>
            <p id="tx-status" style="font-size: 0.8rem; margin-top: 10px; color: #555; text-align: center;">Standby...</p>
        </div>

        <div class="panel">
            <h2>üß† AI METRICS</h2>
            <p>Accuracy: 87.4%</p>
            <p>Whales Tracked: 1,420</p>
            <p>Total Yield Paid: 45,000 TRX</p>
            <div style="height: 10px; background: #333; margin-top: 10px;">
                <div style="width: 87%; height: 100%; background: var(--neon-green);"></div>
            </div>
        </div>
    </div>
    <script>
        // ‚ö†Ô∏è PASTE YOUR DEPLOYED SHASTA CONTRACT ADDRESS HERE
        const CONTRACT_ADDRESS = "TNu2WufgBwb6v3R8ZT4SpN9tHfzTHqxfiG"; // <--- REPLACE THIS

        // --- UI UTILS ---
        function log(msg, type="info") {
            const feed = document.getElementById('log-feed');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const time = new Date().toLocaleTimeString();
            entry.innerHTML = `<span class="timestamp">${time}</span> ${msg}`;
            feed.prepend(entry);
        }

        // --- CONNECT WALLET MANUALLY ---
        let userAddress = null;

        async function connectWallet() {
            // 1. Check if Extension exists
            if (!window.tronWeb) {
                alert("Please install TronLink!");
                return;
            }

            // 2. Request Access (This triggers the popup)
            const result = await window.tronWeb.request({ method: 'tron_requestAccounts' });
            
            if (result.code === 200 || window.tronWeb.ready) {
                userAddress = window.tronWeb.defaultAddress.base58;
                
                // Update UI
                const statusDot = document.getElementById('wallet-status');
                const addressText = document.getElementById('wallet-address');
                
                statusDot.classList.add('active');
                statusDot.style.background = "#0f0";
                addressText.innerText = userAddress;
                addressText.style.color = "#0f0";
                
                log(`LINK ESTABLISHED: ${userAddress}`);
                log(`NETWORK: SHASTA TESTNET`, "info");
            } else {
                alert("Please unlock TronLink and try again.");
            }
        }

        // --- DEPOSIT FUNCTION ---
        async function depositFunds() {
            if (!userAddress) {
                await connectWallet(); // Try connecting first
                if(!userAddress) return; 
            }

            const handle = document.getElementById('twitter-handle').value;
            const amountInput = document.getElementById('deposit-amount').value;
            const statusLabel = document.getElementById('tx-status');

            if (!handle || !amountInput) return alert("ENTER DETAILS");

            try {
                statusLabel.innerText = "‚è≥ REQUESTING SIGNATURE...";
                statusLabel.style.color = "#ffff00";

                const contract = await window.tronWeb.contract().at(CONTRACT_ADDRESS);
                const amountInSun = window.tronWeb.toSun(amountInput);

                // Use send() to trigger the transaction
                const txId = await contract.registerAndDeposit(handle).send({
                    callValue: amountInSun
                });

                statusLabel.innerText = "‚úÖ DEPOSIT SENT";
                statusLabel.style.color = "#0f0";
                
                log(`DEPOSIT SUCCESS: ${amountInput} TRX`, "alert");
                log(`TX ID: ${txId}`);

                // Clear inputs
                document.getElementById('deposit-amount').value = "";

            } catch (e) {
                console.error(e);
                statusLabel.innerText = "‚ùå FAILED / REJECTED";
                statusLabel.style.color = "#f00";
                log(`ERROR: ${e}`, "alert");
            }
        }

        // Add a visible connect button functionality to the status text
        document.getElementById('wallet-address').onclick = connectWallet;
        document.getElementById('wallet-address').style.cursor = "pointer";
        document.getElementById('wallet-address').innerText = "CLICK TO CONNECT WALLET";

    </script>
</body>
</html>